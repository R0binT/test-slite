{"version":3,"sources":["../../../../../../node_modules/acorn-jsx/node_modules/acorn/src/tokencontext.js"],"names":["TokContext","token","isExpr","preserveSpace","override","types","b_stat","b_expr","b_tmpl","p_stat","p_expr","q_tmpl","p","readTmplToken","f_expr","pp","prototype","initialContext","braceIsBlock","prevType","colon","parent","curContext","_return","test","input","slice","lastTokEnd","start","_else","semi","eof","parenR","braceL","exprAllowed","updateContext","update","type","keyword","dot","call","beforeExpr","braceR","context","length","out","pop","push","dollarBraceL","parenL","statementParens","_if","_for","_with","_while","incDec","_function","backQuote"],"mappings":"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","file":"tokencontext.js","sourcesContent":["// The algorithm used to determine whether a regexp can appear at a\n// given point in the program is loosely based on sweet.js' approach.\n// See https://github.com/mozilla/sweet.js/wiki/design\n\nimport {Parser} from \"./state\"\nimport {types as tt} from \"./tokentype\"\nimport {lineBreak} from \"./whitespace\"\n\nexport class TokContext {\n  constructor(token, isExpr, preserveSpace, override) {\n    this.token = token\n    this.isExpr = !!isExpr\n    this.preserveSpace = !!preserveSpace\n    this.override = override\n  }\n}\n\nexport const types = {\n  b_stat: new TokContext(\"{\", false),\n  b_expr: new TokContext(\"{\", true),\n  b_tmpl: new TokContext(\"${\", true),\n  p_stat: new TokContext(\"(\", false),\n  p_expr: new TokContext(\"(\", true),\n  q_tmpl: new TokContext(\"`\", true, true, p => p.readTmplToken()),\n  f_expr: new TokContext(\"function\", true)\n}\n\nconst pp = Parser.prototype\n\npp.initialContext = function() {\n  return [types.b_stat]\n}\n\npp.braceIsBlock = function(prevType) {\n  if (prevType === tt.colon) {\n    let parent = this.curContext()\n    if (parent === types.b_stat || parent === types.b_expr)\n      return !parent.isExpr\n  }\n  if (prevType === tt._return)\n    return lineBreak.test(this.input.slice(this.lastTokEnd, this.start))\n  if (prevType === tt._else || prevType === tt.semi || prevType === tt.eof || prevType === tt.parenR)\n    return true\n  if (prevType == tt.braceL)\n    return this.curContext() === types.b_stat\n  return !this.exprAllowed\n}\n\npp.updateContext = function(prevType) {\n  let update, type = this.type\n  if (type.keyword && prevType == tt.dot)\n    this.exprAllowed = false\n  else if (update = type.updateContext)\n    update.call(this, prevType)\n  else\n    this.exprAllowed = type.beforeExpr\n}\n\n// Token-specific context update code\n\ntt.parenR.updateContext = tt.braceR.updateContext = function() {\n  if (this.context.length == 1) {\n    this.exprAllowed = true\n    return\n  }\n  let out = this.context.pop()\n  if (out === types.b_stat && this.curContext() === types.f_expr) {\n    this.context.pop()\n    this.exprAllowed = false\n  } else if (out === types.b_tmpl) {\n    this.exprAllowed = true\n  } else {\n    this.exprAllowed = !out.isExpr\n  }\n}\n\ntt.braceL.updateContext = function(prevType) {\n  this.context.push(this.braceIsBlock(prevType) ? types.b_stat : types.b_expr)\n  this.exprAllowed = true\n}\n\ntt.dollarBraceL.updateContext = function() {\n  this.context.push(types.b_tmpl)\n  this.exprAllowed = true\n}\n\ntt.parenL.updateContext = function(prevType) {\n  let statementParens = prevType === tt._if || prevType === tt._for || prevType === tt._with || prevType === tt._while\n  this.context.push(statementParens ? types.p_stat : types.p_expr)\n  this.exprAllowed = true\n}\n\ntt.incDec.updateContext = function() {\n  // tokExprAllowed stays unchanged\n}\n\ntt._function.updateContext = function(prevType) {\n  if (prevType.beforeExpr && prevType !== tt.semi && prevType !== tt._else &&\n      !((prevType === tt.colon || prevType === tt.braceL) && this.curContext() === types.b_stat))\n    this.context.push(types.f_expr)\n  this.exprAllowed = false\n}\n\ntt.backQuote.updateContext = function() {\n  if (this.curContext() === types.q_tmpl)\n    this.context.pop()\n  else\n    this.context.push(types.q_tmpl)\n  this.exprAllowed = false\n}\n"]}